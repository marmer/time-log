(this["webpackJsonptime-log"]=this["webpackJsonptime-log"]||[]).push([[0],{153:function(e,t,n){},167:function(e,t){},169:function(e,t,n){},170:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(39),o=n.n(i),c=n(26),l=n(5),u=n(6),s=n(23),m=n(22),d=n(24),p=n(85),g=n.n(p),f=n(11),h=n.n(f);n(97);function y(e){return r.a.createElement(c.b,{render:function(t){var n=t.history;return r.a.createElement("div",null,r.a.createElement("button",{title:"go day back",onClick:function(){n.push("/days/".concat(h()(e.day).subtract(1,"day").format("YYYY-MM-DD"))),window.location.reload()}},r.a.createElement("i",{className:"fa fa-arrow-left"})),r.a.createElement(g.a,{dropdownMode:"scroll",showMonthDropdown:!0,showYearDropdown:!0,useShortMonthInDropdown:!0,showWeekNumbers:!0,todayButton:"today",dateFormat:"yyyy-MM-dd",selected:e.day,onChange:function(e){e&&(n.push("/days/".concat(h()(e).format("YYYY-MM-DD"))),window.location.reload())}}),r.a.createElement("button",{title:"go day forward",onClick:function(){n.push("/days/".concat(h()(e.day).add(1,"day").format("YYYY-MM-DD"))),window.location.reload()}},r.a.createElement("i",{className:"fa fa-arrow-right"})))}})}var v=n(27),E=n(12),b=n(4),T=n.n(b),D=n(7),x=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(s.a)(this,Object(m.a)(t).call(this,"TimeLogDatabase"))).timelogDay=void 0,e.timlogExpectationSettings=void 0,e.version(1).stores({timelogDay:"day, timelogs.durationInMinutes",timlogExpectationSettings:"validFrom"}),e.timelogDay=e.table("timelogDay"),e.timlogExpectationSettings=e.table("timlogExpectationSettings"),e}return Object(d.a)(t,e),Object(u.a)(t,[{key:"clearAllTables",value:function(){var e=Object(D.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.timelogDay.clear(),this.timlogExpectationSettings.clear()]));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(n(88).a),O=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"saveTimelogs",value:function(){var t=Object(D.a)(T.a.mark((function t(n,a){return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.db.timelogDay.put({day:e.toKey(n),timelogs:a}).then((function(){return a})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getTimeLogsForDay",value:function(){var t=Object(D.a)(T.a.mark((function t(n){var a;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.db.timelogDay.get(e.toKey(n));case 2:return a=t.sent,t.abrupt("return",a?a.timelogs:[]);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSumOfTimeLoggedBetween",value:function(){var t=Object(D.a)(T.a.mark((function t(n,a){return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.db.timelogDay.where("day").between(this.toKey(n),this.toKey(a),!0,!0).toArray().then((function(e){return e.map((function(e){return e.timelogs})).reduce((function(e,t){return[].concat(Object(v.a)(e),Object(v.a)(t))}),[]).map((function(e){return e.durationInMinutes})).reduce((function(e,t){return e+t}),0)})));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"toKey",value:function(e){return h()(e).format("YYYY-MM-DD")}}]),e}();O.db=new x;var S=(new x).timlogExpectationSettings,k=h()(new Date(0)).format("YYYY-MM-DD"),w=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"getExpectedDailyTimeToLogInMinutes",value:function(){var e=Object(D.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get(k);case 2:return t=e.sent,e.abrupt("return",t?t.expectedDailyTimeToLogInMinutes:null);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getExpectedDailyTimelogSettings",value:function(){var e=Object(D.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get(k);case 2:return t=e.sent,e.abrupt("return",t?{expectedTimelogDays:t.expectedTimelogDays,expectedDailyTimeToLogInMinutes:t.expectedDailyTimeToLogInMinutes}:null);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setExpectedDailyTimelogSettings",value:function(){var e=Object(D.a)(T.a.mark((function e(t){var n,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.expectedDailyTimeToLogInMinutes,a=t.expectedTimelogDays,e.next=3,S.put({validFrom:k,expectedDailyTimeToLogInMinutes:n,expectedTimelogDays:Object(E.a)({},a)});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),j=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"setExpectedDailyTimelogSettings",value:function(){var e=Object(D.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.setExpectedDailyTimelogSettings(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getExpectedDailyTimelogSettings",value:function(){var e=Object(D.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.getExpectedDailyTimelogSettings();case 2:return t=e.sent,480,e.abrupt("return",t||{expectedDailyTimeToLogInMinutes:480,expectedTimelogDays:{sunday:!1,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1}});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getExpectedDailyTimeToLogInMinutesFor",value:function(){var e=Object(D.a)(T.a.mark((function e(t){var n,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getExpectedDailyTimelogSettings();case 2:return n=e.sent,a=this.isExpectedWeekday(t,n),e.abrupt("return",a?n.expectedDailyTimeToLogInMinutes:0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isExpectedWeekday",value:function(e,t){var n=t.expectedTimelogDays,a=n.monday,r=n.friday,i=n.thursday,o=n.wednesday,c=n.tuesday,l=n.sunday,u=n.saturday;switch(e.getDay()){case 1:return a;case 2:return c;case 3:return o;case 4:return i;case 5:return r;case 6:return u;default:return l}}}]),e}(),I=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"saveTimeLogsForDay",value:function(){var e=Object(D.a)(T.a.mark((function e(t,n){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.saveTimelogs(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTimeLogsForDay",value:function(){var e=Object(D.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.getTimeLogsForDay(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getExpectedTimeToLogDeltaInMonthInMinutesUntilExclusive",value:function(){var t=Object(D.a)(T.a.mark((function t(n){var a,r,i,o,c,l=this;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1!==n.getDate()){t.next=2;break}return t.abrupt("return",0);case 2:return a=h()(n).set("date",1),r=h()(n).subtract(1,"day"),t.next=6,j.getExpectedDailyTimelogSettings();case 6:return i=t.sent,o=e.getDateRangeInclusive(a,r).filter((function(e){return l.isExpectedDay(e,i)})).length,t.next=10,O.getSumOfTimeLoggedBetween(a.toDate(),r.toDate());case 10:return c=t.sent,t.abrupt("return",i.expectedDailyTimeToLogInMinutes*o-c);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"isExpectedDay",value:function(e,t){return j.isExpectedWeekday(e.toDate(),t)}},{key:"getDateRangeInclusive",value:function(e,t){for(var n=[],a=e;!a.isAfter(t);)n.push(a),a=a.clone().add(1,"day");return n}}]),e}(),N={},L=N.m={symbol:"m",factor:1},M=N.h={symbol:"h",factor:60*L.factor},A=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"minutesToJiraFormat",value:function(t){var n=Math.abs(t),a="".concat(e.hourPartOf(n)," ").concat(e.minutePartOf(n)).replace(/\s+/," ").trim();return""===a?"0"+L.symbol:t<0?"-"+a:a}},{key:"isValidJiraFormat",value:function(e){var t=Object.keys(N).join();return new RegExp("^-?\\s*((\\d+["+t+"]?(\\s+\\d+["+t+"]?)*?)|(0+))?\\s*$").test(e)}},{key:"jiraFormatToMinutes",value:function(t){if(!e.isValidJiraFormat(t))throw new Error("'"+t+"' is not a valid jira String");var n=t.startsWith("-");return(n?t.substr(1,t.length):t).split(/\s+/).map(e.toMinutes).reduce(U)*(n?-1:1)}},{key:"hoursOf",value:function(e){return Math.floor(e/M.factor)}},{key:"minutesOf",value:function(e){return Math.floor(e%M.factor/L.factor)}},{key:"minutePartOf",value:function(t){return e.unitStringFor(e.minutesOf(t),L)}},{key:"hourPartOf",value:function(t){return e.unitStringFor(e.hoursOf(t),M)}},{key:"unitStringFor",value:function(e,t){return 0===e?"":e+t.symbol}},{key:"toMinutes",value:function(e){return e.trim().match(/^\d+$/)?Number.parseInt(e):Object.keys(N).map((function(e){return N[e]})).map((function(t){var n=e.match(new RegExp("(\\d+)"+t.symbol,"g"));return n?n.map((function(e){return Number.parseInt(e.replace(t.symbol,""),0)*t.factor})).reduce(U):0})).reduce(U)}}]),e}();function U(e,t){return e+t}n(153);var Y=n(89),C=n.n(Y),R=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e))).state={timeLogsInput:[],timelogs:{loadingState:"LOADING"},expectedDailyTimeToLogInMinutes:{loadingState:"LOADING"},expectedTimeToLogDeltaInMonthInMinutesUntilExclusive:{loadingState:"LOADING"},timelogsSaveError:null},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadTimelogs(),this.loadExpectedDailyTimeToLogInMinutes(),this.loadExpectedTimeToLogDeltaInMonthInMinutesUntilExclusive()}},{key:"componentDidUpdate",value:function(e,n){C()(this.state.timeLogsInput[this.state.timeLogsInput.length-1],t.emptyTimelogInput)||this.addTimelog()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onKeyDown:function(t){t.ctrlKey&&"s"===t.key&&e.store()}},r.a.createElement("form",{target:"_self",onSubmit:function(){return e.isEachTimeLogValid()&&e.store(),!1}},"LOADING"===this.state.timelogs.loadingState?r.a.createElement("p",null,"Loading..."):"ERROR"===this.state.timelogs.loadingState?r.a.createElement("p",null,"Try reloading... ",this.state.timelogs.error.toString()):this.state.timelogsSaveError?r.a.createElement("p",null,"Try again... ",this.state.timelogsSaveError.toString()):r.a.createElement("table",{className:"table table-sm"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{scope:"col",className:"text-sm-center"},"#"),r.a.createElement("th",{scope:"col",className:"text-sm-center"},"Start Time"),r.a.createElement("th",{scope:"col",className:"text-sm-center"},"Duration ",r.a.createElement("em",null,this.getDurationSumAsJiraFormat())),r.a.createElement("th",{scope:"col",className:"text-sm-center"},"Description"),r.a.createElement("th",{scope:"col",className:"text-sm-center"},"Issue"),r.a.createElement("th",{scope:"col",className:"text-sm-center"},"Notes"),r.a.createElement("th",{scope:"col",className:"text-sm-left"},"Actions"))),r.a.createElement("tbody",null,this.state.timeLogsInput.map((function(t,n){return r.a.createElement("tr",{key:n},r.a.createElement("th",{className:"text-sm-center",title:"TimeLog "+n},n),r.a.createElement("td",null,r.a.createElement("input",{className:"fullWidth",disabled:!0,title:"start time",placeholder:"09:15"})),r.a.createElement("td",null,r.a.createElement("input",{className:"fullWidth"+(A.isValidJiraFormat(t.duration)?"":" invalid-format"),title:"duration",type:"text",placeholder:"5h 15m",value:t.duration,onChange:function(t){return e.updateDuration(n,t.target.value)}})),r.a.createElement("td",null,r.a.createElement("input",{className:"fullWidth",title:"description",type:"text",placeholder:"What did you to here",value:t.description,onChange:function(t){return e.updateDescription(n,t.target.value)}})),r.a.createElement("td",null,r.a.createElement("input",{className:"fullWidth",disabled:!0,title:"issue",placeholder:"e.g. ISSUEID-123"})),r.a.createElement("td",null,r.a.createElement("input",{className:"fullWidth",disabled:!0,title:"notes",placeholder:"Not supposed to get exported"})),r.a.createElement("td",null,r.a.createElement("span",{className:"btn-group actions"},r.a.createElement("button",{className:"btn btn-outline-primary",title:"add before this entry",onClick:function(){return e.addTimelogBefore(n)},type:"button"},r.a.createElement("i",{className:"fa fa-plus-circle"})),n<e.state.timeLogsInput.length-1?r.a.createElement("button",{className:"btn btn-outline-primary",title:"remove this entry",onClick:function(){return e.removeTimelogAt(n)},type:"button"},r.a.createElement("i",{className:"fa fa-minus-circle"})):r.a.createElement(r.a.Fragment,null))))})),r.a.createElement("tr",null,r.a.createElement("th",{colSpan:7},r.a.createElement("button",{className:"btn btn-primary fullWidth",title:"save",disabled:this.isAnyTimelogInValid(),type:"submit"},r.a.createElement("i",{className:"fa fa-save"})," save")))))),r.a.createElement("section",{className:"stats"},r.a.createElement("label",null,"Expected time to log since ",h()(this.props.day).format("YYYY-MM-DD"),": ",r.a.createElement("input",{disabled:!0,title:"time left today only",value:this.getDailyExpectationViewValue()})),r.a.createElement("label",null,"Expected time to log since ",h()(this.props.day).set("date",1).format("YYYY-MM-DD"),": ",r.a.createElement("input",{disabled:!0,title:"time left monthly",value:this.getExpectedTimeToLogConsideringTheWholeMonthTillTodayViewValue()}))))}},{key:"loadExpectedTimeToLogDeltaInMonthInMinutesUntilExclusive",value:function(){var e=this;this.setState({expectedTimeToLogDeltaInMonthInMinutesUntilExclusive:{loadingState:"LOADING"}}),I.getExpectedTimeToLogDeltaInMonthInMinutesUntilExclusive(this.props.day).then((function(t){return e.setState({expectedTimeToLogDeltaInMonthInMinutesUntilExclusive:{loadingState:"DONE",value:t}})})).catch((function(t){e.setState({expectedTimeToLogDeltaInMonthInMinutesUntilExclusive:{loadingState:"ERROR",error:t}})}))}},{key:"loadTimelogs",value:function(){var e=this;this.setState({timelogs:{loadingState:"LOADING"}}),I.getTimeLogsForDay(this.props.day).then((function(n){e.setState({timeLogsInput:0===n.length?[Object(E.a)({},t.emptyTimelogInput)]:n.map((function(e){return t.toTimelogInput(e)})),timelogs:{loadingState:"DONE",value:n}})})).catch((function(t){e.setState({timelogs:{loadingState:"ERROR",error:t}})}))}},{key:"loadExpectedDailyTimeToLogInMinutes",value:function(){var e=this;this.setState({expectedDailyTimeToLogInMinutes:{loadingState:"LOADING"}}),j.getExpectedDailyTimeToLogInMinutesFor(this.props.day).then((function(t){return e.setState({expectedDailyTimeToLogInMinutes:{loadingState:"DONE",value:t}})})).catch((function(t){return e.setState({expectedDailyTimeToLogInMinutes:{loadingState:"ERROR",error:t}})}))}},{key:"getDailyExpectationViewValue",value:function(){switch(this.state.expectedDailyTimeToLogInMinutes.loadingState){case"LOADING":return"Loading...";case"DONE":return A.minutesToJiraFormat(this.state.expectedDailyTimeToLogInMinutes.value-this.getDurationSum());case"ERROR":default:return this.state.expectedDailyTimeToLogInMinutes.error.toString()}}},{key:"getExpectedTimeToLogTodayOnly",value:function(){return"DONE"===this.state.expectedDailyTimeToLogInMinutes.loadingState?this.state.expectedDailyTimeToLogInMinutes.value-this.getDurationSum():0}},{key:"getExpectedTimeToLogConsideringTheWholeMonthTillTodayViewValue",value:function(){return"LOADING"===this.state.expectedTimeToLogDeltaInMonthInMinutesUntilExclusive.loadingState||"LOADING"===this.state.expectedDailyTimeToLogInMinutes.loadingState?"Loading...":"DONE"===this.state.expectedTimeToLogDeltaInMonthInMinutesUntilExclusive.loadingState&&"DONE"===this.state.expectedDailyTimeToLogInMinutes.loadingState?A.minutesToJiraFormat(this.state.expectedTimeToLogDeltaInMonthInMinutesUntilExclusive.value+this.getExpectedTimeToLogTodayOnly()):"ERROR"===this.state.expectedDailyTimeToLogInMinutes.loadingState?this.state.expectedDailyTimeToLogInMinutes.error.toString():"ERROR"===this.state.expectedTimeToLogDeltaInMonthInMinutesUntilExclusive.loadingState?this.state.expectedTimeToLogDeltaInMonthInMinutesUntilExclusive.error.toString():void 0}},{key:"addTimelog",value:function(){this.addTimelogBefore(this.state.timeLogsInput.length+1)}},{key:"store",value:function(){var e=this;I.saveTimeLogsForDay(this.props.day,this.state.timeLogsInput.slice(0,this.state.timeLogsInput.length-1).map((function(e){return t.toTimelog(e)}))).then((function(n){return e.setState({timeLogsInput:n.map((function(e){return t.toTimelogInput(e)})),timelogsSaveError:null})})).catch((function(t){return e.setState({timelogsSaveError:t})}))}},{key:"addTimelogBefore",value:function(e){var n=Object(v.a)(this.state.timeLogsInput);n.splice(e,0,Object(E.a)({},t.emptyTimelogInput)),this.setState({timeLogsInput:n})}},{key:"removeTimelogAt",value:function(e){var t=Object(v.a)(this.state.timeLogsInput);t.splice(e,1),this.setState({timeLogsInput:t})}},{key:"updateDuration",value:function(e,t){var n=Object(v.a)(this.state.timeLogsInput);n[e].duration=t,this.setState({timeLogsInput:n})}},{key:"updateDescription",value:function(e,t){var n=Object(v.a)(this.state.timeLogsInput);n[e].description=t,this.setState({timeLogsInput:n})}},{key:"isAnyTimelogInValid",value:function(){return!this.isEachTimeLogValid()}},{key:"isEachTimeLogValid",value:function(){return this.state.timeLogsInput.map((function(e){return A.isValidJiraFormat(e.duration)})).reduce((function(e,t){return e&&t}),!0)}},{key:"getDurationSumAsJiraFormat",value:function(){return A.minutesToJiraFormat(this.getDurationSum())}},{key:"getDurationSum",value:function(){return this.state.timeLogsInput.map((function(e){var t=e.duration;return A.isValidJiraFormat(t)?A.jiraFormatToMinutes(t):0})).reduce((function(e,t){return e+t}),0)}}],[{key:"toTimelog",value:function(e){return{description:e.description,durationInMinutes:A.jiraFormatToMinutes(e.duration)}}},{key:"toTimelogInput",value:function(e){var t=e.description,n=e.durationInMinutes;return{description:t,duration:A.minutesToJiraFormat(n)}}}]),t}(r.a.Component);R.emptyTimelogInput={description:"",duration:""};var F=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e))).state={timeLogs:null},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header d-flex justify-content-center"},r.a.createElement(y,{day:this.props.day})),r.a.createElement("div",{className:"card-body"},r.a.createElement(R,{day:this.props.day})))}}]),t}(r.a.Component),W=function(e){return r.a.createElement("div",null,r.a.createElement("h1",null,"Who told you about this location?"),r.a.createElement("p",null,"Nothing to see here at: ",r.a.createElement("em",null,e.location)))},V=(n(83),n(168),n(35)),_=n(25),J=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"parse",value:function(e){return this.removeSearchStringOpening(e).split("&").filter((function(e){return e[0]})).map((function(e){return e.split("=")})).map((function(e){var t=Object(_.a)(e,2),n=t[0],a=t[1];return Object(V.a)({},n,a?decodeURIComponent(a):"")})).reduce((function(e,t){return Object(E.a)({},e,{},t)}),{})}},{key:"toSearchString",value:function(e){return Object.keys(e).length?"?"+Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).reduce((function(e,t){return e+"&"+t})):"?"}},{key:"removeSearchStringOpening",value:function(e){return e.replace(/^\?/,"")}}]),e}(),G=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"getUserInfo",value:function(){var e=Object(D.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://www.googleapis.com/oauth2/v2/userinfo",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+t}}).then((function(e){if(200!==e.status)throw new Error("Cannot get user infos. Request for User infos end with status code "+e.status);return e.json()})).then((function(e){return{email:e.email}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),B=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"reload",value:function(){window.location.reload()}},{key:"redirectTo",value:function(e){window.location.href=e}}]),e}(),P=n(67),K=n.n(P),z=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"removeCurrentUser",value:function(){return localStorage.removeItem("user")}},{key:"getCurrentUser",value:function(){return K.a.get("user",null)}},{key:"setCurrentUser",value:function(e){K.a.set("user",e)}}]),e}(),H=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"logout",value:function(){q.logout(),z.removeCurrentUser(),B.reload()}},{key:"getCurrentUser",value:function(){return z.getCurrentUser()}},{key:"getMissingEnvironmentVariables",value:function(){return[]}},{key:"redirectToLogin",value:function(){var e={scope:"email https://www.googleapis.com/auth/drive.file",include_granted_scopes:!0,response_type:"token",state:"/",redirect_uri:"https://marmer.github.io/time-log/login.html",client_id:"502499757378-a54o9nthuijpls8ihifb37tltl76tvgj.apps.googleusercontent.com"},t="https://accounts.google.com/o/oauth2/v2/auth"+J.toSearchString(e);B.redirectTo(t)}},{key:"setCurrentuser",value:function(e){z.setCurrentUser(e)}}]),e}(),q=function(){function e(){Object(l.a)(this,e)}return Object(u.a)(e,null,[{key:"logout",value:function(){var e=Object(D.a)(T.a.mark((function e(){var t,n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=H.getCurrentUser(),e.abrupt("return",n?fetch("https://oauth2.googleapis.com/revoke?token="+(null===(t=H.getCurrentUser())||void 0===t?void 0:t.accessToken),{method:"GET",headers:{"content-type":"application/x-www-form-urlencoded"}}):Promise.resolve());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loginBySearchString",value:function(){var e=Object(D.a)(T.a.mark((function e(t){var n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=J.parse(t),e.abrupt("return",G.getUserInfo(n.access_token).then((function(e){return H.setCurrentuser({email:e.email,accessToken:n.access_token}),{sourceUrl:n.state?n.state:"/"}})).catch((function(e){return Promise.reject(new Error("Not able to login the user. Reason: "+e.message))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),$=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e))).state={},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;q.loginBySearchString(this.props.searchString).then((function(t){return e.setState({loginResult:t})})).catch((function(t){return e.setState({loginError:t})}))}},{key:"render",value:function(){var e,t;return this.state.loginResult?r.a.createElement(c.a,{to:null===(e=this.state.loginResult)||void 0===e?void 0:e.sourceUrl}):this.state.loginError?r.a.createElement("div",null,"Error while trying to log you in. Reason: ",null===(t=this.state.loginError)||void 0===t?void 0:t.message):r.a.createElement("div",null,"requesting user data...")}}]),t}(r.a.Component),Q=n(90),X=n(20),Z=function(){return r.a.createElement("header",null,r.a.createElement("nav",{className:"navbar navbar-dark bg-dark"},r.a.createElement(X.b,{to:"/days/today",className:"navbar-brand"},r.a.createElement("img",{src:"/time-log/logo192.png",width:"30",height:"30",className:"d-inline-block align-top",alt:"logo"})," ",Q.name),r.a.createElement("div",{className:"navbar-expand"},r.a.createElement("div",{className:"navbar-nav"},r.a.createElement(X.c,{to:"/days/today",isActive:function(e,t){return t.pathname.startsWith("/day")},className:"nav-item nav-link",activeClassName:"active"},"Logs"),r.a.createElement(X.c,{to:"/settings",className:"nav-item nav-link",activeClassName:"active"},"Settings")))))};function ee(e){return r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"id"),r.a.createElement("th",null,"name"),r.a.createElement("th",null,"content"),r.a.createElement("th",null,"action"))),r.a.createElement("tbody",null,Object.keys(e.files).map((function(t){return e.files[t]})).map((function(t){return r.a.createElement("tr",null,r.a.createElement("td",null,t.id),r.a.createElement("td",null,t.name),r.a.createElement("td",null,t.content),r.a.createElement("td",null,r.a.createElement("button",{onClick:function(){ne(t.id).then((function(){return e.deleteCallback(t)}))}},"delete")))})))))}function te(e){var t;H.getCurrentUser()&&fetch("https://www.googleapis.com/drive/v3/files?=",{method:"GET",headers:{accept:"application/json",authorization:"Bearer "+(null===(t=H.getCurrentUser())||void 0===t?void 0:t.accessToken)}}).then((function(e){if(200!==e.status)throw new Error("bad status code");return e.json()})).then((function(e){return e})).then((function(t){var n=t.files.map((function(e){var t=e.id,n=e.name;return Object(V.a)({},t,{id:t,name:n})})).reduce((function(e,t){return Object(E.a)({},e,{},t)}));e(n),function(e,t){H.getCurrentUser()&&Object.keys(e).forEach((function(n){var a;fetch("https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media"),{method:"GET",headers:{authorization:"Bearer ".concat(null===(a=H.getCurrentUser())||void 0===a?void 0:a.accessToken)}}).then((function(e){return console.log(e),e.text()})).then((function(a){var r=Object(E.a)({},e);r[n].content=a,t(r)})).catch((function(e){console.log(e)}))}))}(n,e)})).catch((function(e){console.log(e)}))}function ne(e){var t;return fetch("https://www.googleapis.com/drive/v3/files/".concat(e),{method:"DELETE",headers:{accept:"application/json",authorization:"Bearer ".concat(null===(t=H.getCurrentUser())||void 0===t?void 0:t.accessToken)}})}var ae,re=function(){var e=Object(a.useState)({}),t=Object(_.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)('{\n  "some": "content"\n}'),c=Object(_.a)(o,2),l=c[0],u=c[1],s=Object(a.useState)("".concat(Math.random(),".json")),m=Object(_.a)(s,2),d=m[0],p=m[1];return Object(a.useEffect)((function(){te(i)}),[]),r.a.createElement("div",null,r.a.createElement("label",null,"File List of google drive files List metadata",r.a.createElement(ee,{files:n,deleteCallback:function(e){var t=Object(E.a)({},n);delete t[e.id],i(t)}})),r.a.createElement("button",{onClick:function(){(function(e){return H.getCurrentUser()?Promise.all(Object.keys(e).map((function(e){return ne(e)}))):Promise.resolve()})(n).then((function(){return i({})}))}},"Delete all!"),r.a.createElement("label",null,"File name",r.a.createElement("input",{value:d,onChange:function(e){return p(e.target.value)}})),r.a.createElement("label",null,"File content",r.a.createElement("textarea",{value:l,onChange:function(e){return u(e.target.value)}})),r.a.createElement("button",{onClick:function(){return function(e){var t;return fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{accept:"application/json","content-type":"multipart/related; boundary=nice_boundary_name",authorization:"Bearer ".concat(null===(t=H.getCurrentUser())||void 0===t?void 0:t.accessToken)},body:'--nice_boundary_name\nContent-Type: application/json; charset=UTF-8\n\n{\n  "name": "'.concat(e.name,'"\n}\n\n--nice_boundary_name\nContent-Type: application/json; charset=UTF-8\n\n').concat(e.content,"\n\n--nice_boundary_name--")}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}({name:d,content:l}).then((function(){return te(i)}))}},"add"))},ie=function(){var e=H.getMissingEnvironmentVariables();if(e&&e.length)return r.a.createElement("section",null,r.a.createElement("strong",null,"Server Missconfiguration. Set the following environment variables are not set properly:"),e.map((function(e){return r.a.createElement("div",{key:e},e)})));var t=H.getCurrentUser();return t?r.a.createElement("section",null,r.a.createElement("p",null,t.email),r.a.createElement("button",{onClick:function(){return H.logout()}},"Logout")):r.a.createElement("section",null,r.a.createElement("button",{onClick:function(){return H.redirectToLogin()}},"Login"))};function oe(){return localStorage.getItem("devMode")?r.a.createElement("div",{className:"devMode"},r.a.createElement(ie,null),r.a.createElement(re,null)):r.a.createElement(r.a.Fragment,null)}function ce(){var e=Object(a.useState)({loadingState:"LOADING"}),t=Object(_.a)(e,2),n=t[0],i=t[1];function o(e){"DONE"===n.loadingState&&i(Object(E.a)({},n,{value:Object(E.a)({},n.value,{expectedTimelogDays:n.value.expectedTimelogDays.map((function(t,n){return n===e?!t:t}))})}))}return Object(a.useEffect)((function(){i({loadingState:"LOADING"}),j.getExpectedDailyTimelogSettings().then((function(e){i({loadingState:"DONE",value:{expectedDailyTimelog:A.minutesToJiraFormat(e.expectedDailyTimeToLogInMinutes),expectedTimelogDays:[e.expectedTimelogDays.saturday,e.expectedTimelogDays.monday,e.expectedTimelogDays.tuesday,e.expectedTimelogDays.wednesday,e.expectedTimelogDays.thursday,e.expectedTimelogDays.friday,e.expectedTimelogDays.sunday]}})}))}),[]),r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},"Day Settings"),r.a.createElement("div",{className:"form-group row card-body"},r.a.createElement("form",{onSubmit:function(e){return"DONE"===n.loadingState&&j.setExpectedDailyTimelogSettings({expectedDailyTimeToLogInMinutes:A.jiraFormatToMinutes(n.value.expectedDailyTimelog),expectedTimelogDays:{sunday:n.value.expectedTimelogDays[ae.SUNDAY],monday:n.value.expectedTimelogDays[ae.MONDAY],tuesday:n.value.expectedTimelogDays[ae.TUESDAY],wednesday:n.value.expectedTimelogDays[ae.WEDNESDAY],thursday:n.value.expectedTimelogDays[ae.THURSDAY],friday:n.value.expectedTimelogDays[ae.FRIDAY],saturday:n.value.expectedTimelogDays[ae.SATURDAY]}}),!1}},r.a.createElement("div",{className:"d-flex flex-column"},r.a.createElement("label",null,"Expected Time to log per day ",r.a.createElement("input",{id:"expectedTimeToLog",type:"text",className:"DONE"===n.loadingState&&A.isValidJiraFormat(n.value.expectedDailyTimelog)?"":" invalid-format",disabled:"DONE"!==n.loadingState,value:"DONE"===n.loadingState?n.value.expectedDailyTimelog:"Loading...",onChange:function(e){var t=e.target;return i(Object(E.a)({},n,{loadingState:"DONE",value:Object(E.a)({},n.value,{expectedDailyTimelog:t.value})}))},placeholder:"e.g. 7h 30m"})),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.MONDAY],onChange:function(e){o(ae.MONDAY)}})," Monday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.TUESDAY],onChange:function(e){o(ae.TUESDAY)}})," Tuesday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.WEDNESDAY],onChange:function(e){o(ae.WEDNESDAY)}})," Wednesday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.THURSDAY],onChange:function(e){o(ae.THURSDAY)}})," Thursday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.FRIDAY],onChange:function(e){o(ae.FRIDAY)}})," Friday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.SATURDAY],onChange:function(e){o(ae.SATURDAY)}})," Saturday"),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",disabled:"DONE"!==n.loadingState,checked:"DONE"===n.loadingState&&n.value.expectedTimelogDays[ae.SUNDAY],onChange:function(e){o(ae.SUNDAY)}})," Sunday"),r.a.createElement("button",{className:"btn btn-primary fullWidth",title:"save",disabled:"DONE"!==n.loadingState||!A.isValidJiraFormat(n.value.expectedDailyTimelog),type:"submit"},r.a.createElement("i",{className:"fa fa-save"})," save")))))}!function(e){e[e.SUNDAY=0]="SUNDAY",e[e.MONDAY=1]="MONDAY",e[e.TUESDAY=2]="TUESDAY",e[e.WEDNESDAY=3]="WEDNESDAY",e[e.THURSDAY=4]="THURSDAY",e[e.FRIDAY=5]="FRIDAY",e[e.SATURDAY=6]="SATURDAY"}(ae||(ae={}));var le=function(){return r.a.createElement("section",null,r.a.createElement(ce,null))};var ue=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(169);o.a.render(r.a.createElement(X.a,{basename:"time-log"},r.a.createElement((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Z,null),r.a.createElement(oe,null),r.a.createElement("main",null,r.a.createElement(c.b,{render:function(e){return e.history.listen((function(){return window.location.reload()})),r.a.createElement(c.d,null,r.a.createElement(c.b,{exact:!0,path:"/login/:provider",render:function(e){return r.a.createElement($,{searchString:e.location.search})}}),r.a.createElement(c.b,{exact:!0,path:"/"},r.a.createElement(c.a,{to:"/days"})),r.a.createElement(c.b,{exact:!0,path:"/days"},r.a.createElement(c.a,{to:"/days/today"})),r.a.createElement(c.b,{exact:!0,path:"/days/today"},r.a.createElement(F,{day:new Date})),r.a.createElement(c.b,{exact:!0,path:"/days/:day",render:function(e){return h()(e.match.params.day).isValid()?r.a.createElement(F,{day:h()(e.match.params.day).toDate()}):r.a.createElement(W,{location:e.location.pathname})}}),r.a.createElement(c.b,{exact:!0,path:"/settings"},r.a.createElement(le,null)),r.a.createElement(c.b,{render:function(e){return r.a.createElement(W,{location:e.location.pathname})}}))}})))}),null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/time-log",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/time-log","/service-worker.js");ue?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):se(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):se(t,e)}))}}()},90:function(e){e.exports=JSON.parse('{"name":"time-log","version":"0.1.0","private":true,"homepage":"https://marmer.github.io/time-log/","author":{"name":"MarMer"},"license":"GPL3","jest":{"coveragePathIgnorePatterns":["/src/serviceWorker.ts","/src/index.ts","/src/setupTests.ts",".*__spikes__.*"],"coverageReporters":["cobertura","lcov"]},"dependencies":{"bootstrap":"^4.4.1","deep-equal":"^2.0.1","deepmerge":"^4.2.2","dexie":"^2.0.4","firebase":"^7.11.0","font-awesome":"^4.7.0","lockr":"^0.8.5","moment":"^2.24.0","npm":"^6.13.7","react":"^16.12.0","react-datepicker":"^2.11.0","react-dom":"^16.12.0","react-router-dom":"^5.1.2","react-scripts":"3.3.1","typescript":"~3.7.5"},"devDependencies":{"fake-indexeddb":"^3.0.0","@types/deep-equal":"^1.0.1","fetch-mock":"9.0.0-beta.2","node-fetch":"^2.6.0","@types/lockr":"^0.8.6","@testing-library/jest-dom":"5.1.0","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","@types/jest":"25.1.1","@types/node":"^12.0.0","@types/react":"^16.9.0","@types/react-datepicker":"^2.10.0","@types/react-dom":"^16.9.0","@types/react-router-dom":"^5.1.3","express":"^4.17.1","express-favicon":"^2.0.1","webpack":"^4.41.5"},"scripts":{"predeploy":"npm run build","start":"react-scripts start","build":"react-scripts build","test":"react-scripts test --coverage","eject":"react-scripts eject","prod":"node server.js"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"eslintIgnore":["eslint-disable-next-line"]}')},91:function(e,t,n){e.exports=n(170)}},[[91,1,2]]]);
//# sourceMappingURL=main.7b483158.chunk.js.map